stages:
  - test

run-tests:
  stage: test
  image: mcr.microsoft.com/dotnet/core/sdk:5.0-alpine
  variables:
    MOCK_HOST: docker
  script:
    - dotnet build tests/tests.csproj
    - export MOCK_HOST="$(ip -4 route show default | cut -d' ' -f3)"
    - echo "Using $MOCK_HOST"
    - dotnet test tests/tests.csproj

test-build-test-image:
  stage: test
  image: okinta/podman
  script:
    - podman --storage-driver vfs --cgroup-manager=cgroupfs build -t agrix-tests -f containers/tests/Containerfile .

test-build-image:
  stage: test
  image: okinta/podman
  script:
    - podman --storage-driver vfs --cgroup-manager=cgroupfs build -t okinta/agrix -f containers/agrix/Containerfile .
